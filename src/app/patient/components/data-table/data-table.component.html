<div class="table-container">
    <div class="search-bar">
        <input type="text" placeholder="Search Cases..." [(ngModel)]="searchTerm" (ngModelChange)="filterCases()"
            class="search-input" />
    </div>

    <ngx-datatable class="material custom-table" [rows]="filteredCases" [columnMode]="'force'" [headerHeight]="50"
        [footerHeight]="50" [rowHeight]="'auto'" [limit]="pageSize" [offset]="page" (page)="onPage($event)">
        <ngx-datatable-column name="Case ID" prop="id"></ngx-datatable-column>
        <ngx-datatable-column name="Category" prop="category"></ngx-datatable-column>
        <ngx-datatable-column name="Purpose of Visit" prop="purpose_of_visit"></ngx-datatable-column>
        <ngx-datatable-column name="Case Type" prop="case_type"></ngx-datatable-column>
        <ngx-datatable-column name="DOA" prop="DOA"></ngx-datatable-column>
        <ngx-datatable-column name="Insurance Name" prop="insurance_name"></ngx-datatable-column>
        <ngx-datatable-column name="Firm Name" prop="firm_name"></ngx-datatable-column>
        <ngx-datatable-column name="Practice Location" prop="practice_location_name"></ngx-datatable-column>

        <ngx-datatable-column name="Actions">
            <ng-template ngx-datatable-cell-template let-row="row">
                <div class="action-buttons">
                    <button class="action-btn view-btn" (click)="view(row.id)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn edit-btn" (click)="editCase(row)">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn add-btn" (click)="addAppointment(row.id)">
                        <i class="fas fa-add"></i>
                    </button>

                </div>
            </ng-template>
        </ngx-datatable-column>
    </ngx-datatable>

    <div class="pagination-controls">
        <button class="pagination-btn" (click)="previousPage()" [disabled]="page === 0">
            <span>&#9664;</span> Previous
        </button>
        <button *ngFor="let p of pages" (click)="setPage(p)" [class.active]="p === page" class="page-number">
            {{ p + 1 }}
        </button>
        <button class="pagination-btn" (click)="nextPage()" [disabled]="page >= (filteredCases.length / pageSize) - 1">
            Next <span>&#9654;</span>
        </button>
    </div>
</div>

<!-- Appointment -->
<div class="table-container">
    <div class="search-bar">
        <input type="text" placeholder="Search Appointments..." class="search-input" />
    </div>
    <div *ngIf="selectedCaseAppointments && selectedCaseAppointments.length">
        <h3>Appointments for Case ID: {{ selectedCaseId }}</h3>
        <ngx-datatable class="material custom-table" [rows]="selectedCaseAppointments" [columnMode]="'force'"
            [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'">
            <ngx-datatable-column name="Appointment ID" prop="id"></ngx-datatable-column>

            <!-- Description Column -->
            <ngx-datatable-column name="Description" prop="Description">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <span class="description-text" [matTooltip]="row.Description" matTooltipPosition="above"
                        matTooltipShowDelay="300" [attr.title]="row.Description"
                        [ngClass]="{'text-truncated': row.Description.length > 15}">
                        {{ row.Description.length > 15 ? (row.Description | slice:0:15) + '...' : row.Description }}
                    </span>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Date" prop="date"></ngx-datatable-column>
            <ngx-datatable-column name="Time" prop="appointment_time"></ngx-datatable-column>
            <ngx-datatable-column name="Duration" prop="Duration"></ngx-datatable-column>
            <ngx-datatable-column name="Doctor Name" prop="doctor_name"></ngx-datatable-column>
            <ngx-datatable-column name="Appointment Type" prop="appointment_type"></ngx-datatable-column>
            <ngx-datatable-column name="Location" prop="practice_location_name"></ngx-datatable-column>
            <ngx-datatable-column name="Specialty" prop="speciality_name"></ngx-datatable-column>

            <ngx-datatable-column name="Actions">
                <ng-template ngx-datatable-cell-template let-row="row">
                    <button class="edit-btn" (click)="editAppointment(row)">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>
    </div>
    <div class="pagination-controls">
        <button class="pagination-btn" (click)="previousPage()" [disabled]="page === 0">
            <span>&#9664;</span> Previous
        </button>
        <button *ngFor="let p of pages" (click)="setPage(p)" [class.active]="p === page" class="page-number">
            {{ p + 1 }}
        </button>
        <button class="pagination-btn" (click)="nextPage()"
            [disabled]="page >= (selectedCaseAppointments.length / pageSize) - 1">
            Next <span>&#9654;</span>
        </button>
    </div>
</div>
